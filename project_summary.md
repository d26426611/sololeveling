# Project: 無盡爬塔：深淵傳說 (Endless Tower Climb: Abyss Legend)

This project is a single-page web-based role-playing game featuring character creation, turn-based combat, item management, crafting, and various in-game events.

## 檔案結構

```
.
├───combat.js
├───core.js
├───data.js
├───index.html
├───main.js
└───style.css
```

## 檔案說明

### `index.html`
這是遊戲的入口文件，定義了遊戲的整體 HTML 結構。
- 包含一個角色創建的初始設置畫面，允許玩家選擇種族和職業。
- 遊戲主介面分為三個主要區域：
    - 左側：玩家狀態面板（顯示 HP, ATK, SPD, CRI, DEF, 理智, 業力等屬性，以及裝備欄位）。
    - 中間：主舞台，用於顯示事件或戰鬥畫面。
    - 右側：功能面板，包含背包、合成、圖鑑和系統（存檔/讀取）等標籤頁。
- 包含用於彈出訊息（toast）和確認對話框（modal）的元素。
- 按順序載入 `data.js`, `core.js`, `combat.js`, `main.js`。

### `style.css`
負責遊戲的視覺呈現和樣式。
- 使用 CSS 變數定義了遊戲的主題顏色、背景、邊框等。
- 包含按鈕、選擇網格、全螢幕覆蓋層等 UI 元素的通用樣式。
- 利用 CSS Grid 佈局主介面的三個區域。
- 詳細定義了玩家面板、事件卡片、戰鬥介面（單位資訊、血條、行動條、戰鬥日誌）的樣式。
- 為物品列表和基於稀有度的顏色（如普通、稀有、傳說等）提供了樣式規則。
- 包含了響應式設計，以適應不同螢幕尺寸。

### `data.js`
遊戲的數據配置文件，以 `CONFIG` 常數的形式定義了大量的遊戲內容和平衡參數。
- **種族 (races)**：定義了不同種族的名稱、描述、屬性修正（如生命值、攻擊力、速度）和特殊特質。
- **職業 (classes)**：定義了不同職業的名稱、描述、額外屬性、戰鬥風格、升級路徑以及隱藏職業的解鎖條件。
- **生物群系 (biomes)**：定義了遊戲中的不同區域，包括名稱、圖標、顏色、進入深度、相關物品套裝、難度縮放、怪物列表和區域 Boss。
- **怪物 (monsters)**：詳細定義了各種怪物的基礎屬性（HP, ATK, SPD）、金幣掉落、類型和可能掉落的材料。
- **特殊物品 (specialItems)**：定義了如「靈魂定錨」等具有特殊效果的物品。
- **事件 (events)**：定義了遊戲中可能觸發的隨機事件及其權重，如賭徒、詛咒之劍、煉金術師等。
- **物品池 (itemPool)**：定義了不同物品套裝和通用物品的基礎屬性。
- **套裝 (sets)**：定義了裝備特定套裝物品數量時提供的額外屬性獎勵。
- **材料 (materials)**：定義了各種合成材料及其價值。
- **合成配方 (recipes)**：定義了可合成的物品、所需材料、產物屬性以及稀有度。
- **稀有度 (rarity)**：定義了物品的稀有度等級、顏色、屬性倍率和生成機率。
- **詞綴 (affixes)**：定義了物品可能擁有的前綴和後綴，以及它們對物品屬性的影響。

### `core.js`
包含了遊戲的核心邏輯和多個管理系統。
- **UI 函式 (UI Object)**：提供與使用者互動相關的函式，如 `toast` (顯示提示訊息)、`confirm` (顯示確認對話框)、`showDamage` (顯示飄動傷害數值)、`shake` (搖晃動畫)。
- **全域系統 (GlobalSystem Object)**：管理遊戲全域數據，如已解鎖的種族、職業、圖鑑物品和最大深度，並負責將這些數據存儲到 `localStorage`。包含 `unlockClass`、`registerItem`、`checkLegacy` 等函式。
- **玩家物件 (Player Object)**：定義了玩家的詳細狀態，包括角色名稱、種族、職業、深度、金幣、當前生命值、行動條、當前生物群系、世界類型（普通、幻界、煉獄）、理智值、業力值、詳細屬性、物品欄和裝備。
- **物品系統 (ItemSystem Object)**：負責生成遊戲中的物品，根據稀有度、深度和世界類型生成不同品質的物品，並添加隨機詞綴。
- **物品欄系統 (Inventory Object)**：管理玩家物品欄，包括添加、移除、分解物品（獲得魔塵）、計數材料、裝備/卸下物品和使用消耗品。也負責渲染物品欄介面。
- **鐵匠系統 (Blacksmith Object)**：提供強化已裝備物品的功能，消耗金幣提升物品等級和屬性。
- **合成系統 (Crafting Object)**：管理物品合成功能，顯示可合成配方、檢查材料是否足夠，並執行合成操作。
- **商人系統 (Merchant Object)**：允許玩家向商人出售物品，根據物品價值獲得金幣。
- **圖鑑系統 (Compendium Object)**：記錄玩家已發現的物品，並在介面中顯示。
- **存儲系統 (StorageSystem Object)**：處理遊戲的存檔和讀檔，支援手動存檔、重置進度以及匯出/匯入存檔代碼。

### `combat.js`
實現了遊戲的戰鬥系統。
- **戰鬥日誌模板 (LOG_TEMPLATES & getNarrative)**：定義了戰鬥訊息的文本模板和隨機選擇函式，用於生成戰鬥日誌。
- **戰鬥系統物件 (BattleSystem Object)**：
    - 管理戰鬥的啟動、自動模式、敵方資訊和行動條閾值。
    - `start()`：初始化一場戰鬥，計算敵人的屬性（基於模板、生物群系縮放、玩家深度和世界類型），並設定戰鬥日誌。
    - `nextTick()`：遊戲的核心戰鬥循環，根據速度推進玩家和敵人的行動條，並在達到閾值時觸發攻擊。
    - `executeTurn(atker, dfder)`：執行單次攻擊，計算傷害（考慮暴擊、閃避、格擋、傷害減免、吸血、反擊、額外回合、多重打擊等），更新生命值，並記錄戰鬥日誌。
    - `escape()`：嘗試從戰鬥中逃跑。
    - `autoResolve()`：快速解決戰鬥，直接得到結果。
    - `checkEnd()`：檢查戰鬥是否結束，並處理戰敗（死亡、進入煉獄）或勝利（獲得金幣、材料、物品、觸發覺醒事件）後的邏輯。
    - `exitCombat()`：結束戰鬥，返回事件畫面並推進深度。

### `main.js`
遊戲的主邏輯文件，協調各個系統運作。
- **事件導演 (EventDirector Object)**：
    - `checkAwakening()`：檢查是否滿足隱藏職業的覺醒條件。
    - `trigger()`：根據權重隨機觸發一個事件，如賭徒、詛咒之劍、煉金術士、治療之泉、陷阱、寶箱、惡魔低語、黑市商人。
- **遊戲物件 (Game Object)**：
    - `init()`：遊戲初始化入口，設置 UI 元素、事件監聽器，並檢查是否有存檔可供讀取。
    - `renderSetup()` 和 `updateSetupUI()`：處理角色創建畫面的渲染和交互。
    - `startGame()`：開始新遊戲，初始化玩家角色、物品和遊戲狀態。
    - `recalcPlayerStats()`：重新計算玩家屬性。
    - `nextDepth()`：推進遊戲深度，根據深度切換生物群系，處理理智值變化（幻界）、生命值恢復，並決定下一個遭遇（戰鬥、事件、Boss 戰、晉升）。
    - `triggerCombat()` / `triggerBoss()` / `triggerChest()`：觸發特定類型的遭遇。
    - `renderEvent()`：通用事件渲染函式，用於顯示事件資訊和按鈕選項。
    - `openScreen()`：在事件畫面和戰鬥畫面之間切換。
    - `updateHeader()`：更新遊戲介面頂部的玩家資訊和狀態顯示。
    - `enterWorld()` 和 `leaveWorld()`：處理進入或離開特殊世界（幻界、煉獄）時的邏輯和視覺變化。
- `window.onload = () => Game.init();`：確保在頁面完全載入後啟動遊戲。

## 專案核心功能
- **角色創建與發展**：玩家可選擇種族和職業，這些選擇會影響角色的基礎屬性和成長路線。
- **多樣化的戰鬥系統**：回合制戰鬥，敵人具有難度縮放，包含暴擊、閃避、格擋、吸血、反擊等多種戰鬥機制，以及職業獨特的戰鬥風格。
- **物品與裝備管理**：玩家可以獲得、裝備、分解物品，並通過套裝效果和詞綴提升屬性。
- **深度與生物群系探索**：遊戲深度不斷增加，玩家會進入不同的生物群系，每個群系有獨特的怪物和 Boss。
- **合成與經濟系統**：玩家可以收集材料合成新物品，也可以出售物品賺取金幣。
- **豐富的隨機事件**：探索過程中會遇到多種隨機事件，提供不同的選擇和結果。
- **圖鑑系統**：記錄玩家已發現的物品，提升收集樂趣。
- **存檔與讀檔**：支持自動存檔、手動存檔、重置進度以及匯出/匯入存檔代碼。
- **特殊世界機制**：引入「幻界」（理智值）和「煉獄」（業力值），為遊戲增加了獨特的挑戰和敘事元素。

## 總結
這是一個基於瀏覽器開發的文字與圖標冒險 RPG 遊戲，其核心玩法圍繞著角色養成、策略戰鬥、物品收集和深度探索。通過模組化的 JavaScript 檔案，實現了清晰的邏輯分離和豐富的遊戲內容。
